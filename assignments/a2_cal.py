import matplotlib.pyplot as plt
import numpy as np

# fmt: off
m_all = {
    'Table': {100: [92, 92, 92, 92, 92, 91, 91, 91, 91, 91, 91, 92, 92, 91, 91, 91, 92, 92, 91, 91], 500: [477, 478, 477, 477, 478, 478, 477, 477, 477, 476, 478, 477, 477, 478, 477, 478, 476, 478, 477, 476], 1000: [988, 988, 988, 983, 985, 988, 987, 983, 988, 987, 987, 985, 983, 987, 983, 988, 987, 983, 988, 987], 1500: [1482, 1482, 1482, 1482, 1482, 1482, 1482, 1482, 1482, 1482, 1481, 1481, 1482, 1482, 1482, 1482, 1482, 1482, 1482, 1482], 2000: [1979, 1979, 1979, 1979, 1979, 1979, 1978, 1979, 1979, 1979, 1979, 1979, 1979, 1978, 1978, 1978, 1977, 1978, 1977, 1978]},
    'Leg': {100: [150, 149, 149, 149, 149, 149, 149, 149, 149, 150, 149, 149, 149, 149, 149, 149, 150, 149, 149, 149], 500: [512, 508, 508, 508, 507, 508, 516, 512, 504, 509, 512, 509, 500, 508, 512, 512, 507, 503, 509, 503], 1000: [1032, 1032, 1032, 1032, 1032, 1032, 1033, 1032, 1032, 1030, 1031, 1030, 1031, 1020, 1000, 986, 982, 979, 982, 986], 1500: [1535, 1536, 1535, 1535, 1535, 1535, 1535, 1535, 1535, 1535, 1535, 1535, 1535, 1535, 1535, 1538, 1535, 1535, 1539, 1539], 2000: [1927, 1923, 1934, 1931, 1927, 1923, 1931, 1935, 1932, 1930, 1929, 1932, 1939, 1935, 1944, 1935, 1944, 1931, 1939, 1939]},
    'Umbrella': {100: [125, 124, 125, 120, 120, 120, 121, 120, 124, 125, 124, 124, 124, 125, 124, 124, 124, 128, 128, 128], 500: [536, 536, 536, 535, 536, 536, 536, 536, 536, 536, 536, 536, 516, 511, 512, 512, 512, 512, 512, 512], 1000: [998, 999, 998, 999, 999, 998, 998, 999, 999, 998, 998, 999, 998, 999, 999, 998, 998, 1000, 998, 998], 1500: [1504, 1505, 1505, 1505, 1504, 1504, 1504, 1505, 1505, 1508, 1509, 1510, 1515, 1515, 1509, 1509, 1509, 1505, 1505, 1505], 2000: [2009, 2008, 2007, 2008, 2004, 2004, 2004, 2012, 2016, 2020, 2008, 2008, 2007, 2007, 2011, 2011, 2029, 2212, 2029, 2024]},
    'Wall panel': {100: [109, 108, 109, 108, 109, 108, 109, 108, 108, 108, 108, 109, 108, 109, 108, 109, 108, 108, 109, 108], 500: [515, 512, 511, 511, 511, 511, 511, 511, 512, 511, 511, 511, 511, 512, 511, 512, 511, 511, 511, 511], 1000: [990, 989, 989, 990, 990, 989, 990, 990, 989, 989, 990, 990, 989, 990, 990, 989, 990, 990, 989, 989], 1500: [1485, 1489, 1489, 1485, 1485, 1489, 1489, 1485, 1489, 1485, 1486, 1486, 1490, 1486, 1490, 1486, 1486, 1486, 1486, 1490], 2000: [1977, 1973, 1973, 1973, 1973, 1973, 1973, 1973, 1972, 1972, 1976, 1971, 1972, 1973, 1973, 1973, 1977, 1971, 1973, 1972], 3000: [2963, 2964, 2963, 2963, 2962, 2963, 2963, 2963, 2962, 2963, 2963, 2963, 2963, 2964, 2963, 2963, 2963, 2963, 2963, 2963]},
    'Bottle': {100: [130, 131, 130, 128, 130, 131, 127, 130, 127, 127, 128, 127, 128, 130, 127, 127, 127, 131, 127, 131], 500: [519, 518, 518, 519, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518], 1000: [3102, 1041, 3102, 3102, 3103, 3102, 1820, 1772, 1767, 1726, 3102, 1600, 1591, 1579, 3102, 3103, 1547, 3103, 1538, 1558], 1500: [3102, 3102, 3102, 3102, 3103, 3102, 3102, 3102, 3102, 3103, 3102, 3102, 3103, 3102, 1533, 3103, 3102, 3103, 3102, 3103], 2000: [2223, 2205, 2222, 2246, 2213, 2240, 2163, 2201, 3102, 3102, 3103, 3103, 3102, 3103, 3102, 3102, 2195, 2187, 3102, 3103]},
}
item = 'Bottle'
measurements: dict[int, list[int]] = m_all[item]
# fmt: on
stds = []
print(measurements[1000])
for true, sonar in measurements.items():
    sonar = np.array(sonar)

    print(f"at {true: >5}, measured {sonar.mean() / true:.1%}")
    stds.append(sonar.std())
    plt.scatter(
        np.repeat(true, len(sonar)),
        sonar,
        c="red",
        s=0.1,
        label="Datapoint" if true == 100 else "_",
    )

plt.plot((0, 2_000), (0, 2_000), label="Ideal 1:1", linestyle="dashed")
plt.legend()
plt.title(f"Sonar measurements versus true distance ({item})")
plt.xlabel("True distance (mm)")
plt.ylabel("Sonar measured distance (mm)")
plt.show()
plt.plot(list(measurements.keys()), stds)
plt.title(f"Sonar standard deviation versus distance ({item})")
plt.xlabel("True distance (mm)")
plt.ylabel("Standard deviation (mm)")
plt.show()
